CREATE DATABASE company_db;
USE company_db;

CREATE TABLE employee (
    e_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    address VARCHAR(50) NOT NULL,
    birthday DATE NOT NULL,
    position ENUM(
        'Trainee', 'Personnel', 'Analyst', 'Developer',
        'Project leader', 'Manager', 'CEO', 'Support', 'Staff'
    ) NOT NULL,
    department ENUM(
        'Frontend', 'Backend', 'QA', 'ICT',
        'Human Resources', 'Logistics', 'Research', 'Administration'
    ) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE account (
    a_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    e_id INT NOT NULL UNIQUE,
    username VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('Global Admin', 'Admin', 'User') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_account_employee
        FOREIGN KEY (e_id)
        REFERENCES employee(e_id)
        ON DELETE CASCADE
) ENGINE=InnoDB;

CREATE TABLE session_log (
    sl_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    a_id INT NOT NULL,
    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    status ENUM('Logged In', 'Logged Out') NOT NULL,

    CONSTRAINT fk_session_log_account
        FOREIGN KEY (a_id)
        REFERENCES account(a_id)
        ON DELETE CASCADE
) ENGINE=InnoDB;

CREATE INDEX idx_account_eid ON account(e_id);
CREATE INDEX idx_session_log_aid ON session_log(a_id);

INSERT INTO employee (
    name,
    address,
    birthday,
    position,
    department
) VALUES (
    'Global System Administrator',
    'Head Office',
    '1995-01-01',
    'Manager',
    'ICT'
);

INSERT INTO account (
    e_id,
    username,
    password,
    role
) VALUES (
    1,
    'GlobalAdmin',
    '$2y$10$NKL6oi6k29V029ZMb5.H3eSY//ZfST/aiLe75gFZiOyF883Tjx1Hy',
    'Global Admin'
);

INSERT INTO session_log (
    a_id,
    status
) VALUES (
    1,
    'Logged In'
);